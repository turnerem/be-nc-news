365.25 * 10
file_path <- paste(pc, "modelling2/variable_selection/names_hist*.csv", sep = "")
bef <- paste(pc, "modelling2/variable_selection/names_", sep = "")
aft <- ".csv"
var_name_lists <- lapply(Sys.glob(file_path),
function(x) gsub(aft, "", gsub(bef, "", x)))
var_names <- lapply(Sys.glob(file_path),
function(x) fread(x, header = T))
var_names <- rbindlist(var_names)
var_names <- var_names[, x]
var_names <- lapply(Sys.glob(file_path),
function(x) fread(x, header = T))
var_names <- rbindlist(var_names)
var_names <- var_names[, x]
var_names
vv30 <- grep("_30", var_names, value = T)
vv30 <- grep("_30", var_names, value = T)
vv365 <- grep("_365", var_names, value = T)
vv3643 <- grep("_3643", var_names, value = T)
var_names <- var_names[!grepl("count")]
var_names <- var_names[!grepl("count", var_names)]
vv30 <- grep("_30", var_names, value = T)
vv365 <- grep("_365", var_names, value = T)
vv3643 <- grep("_3643", var_names, value = T)
var_names <- c(vv30, vv365, vv3643)
file_path <- paste(pc, "modelling2/variable_selection/names_index*.csv", sep = "")
bef <- paste(pc, "modelling2/variable_selection/names_", sep = "")
aft <- ".csv"
var_name_lists <- lapply(Sys.glob(file_path),
function(x) gsub(aft, "", gsub(bef, "", x)))
var_names <- lapply(Sys.glob(file_path),
function(x) fread(x, header = T))
var_names <- rbindlist(var_names)
var_names
var_names
file_path <- paste(pc, "modelling2/variable_selection/names_prior_incidents.csv", sep = "")
bef <- paste(pc, "modelling2/variable_selection/names_", sep = "")
aft <- ".csv"
var_name_lists <- "prior_incidents"
var_names <- lapply(Sys.glob(file_path),
function(x) fread(x, header = T))
var_names <- rbindlist(var_names)
var_names
var_names
var_names <- var_names[, x]
person <- ifelse(grepl("perp", vv), "perp", ifelse(grepl("pvic", vv), "pvic", "other"))
F * 1
10000/365
365.5 * 10
365.25 * 10
(pi * 81) / (pi * 64)
ocs
pc <- "/Users/emilyturner/Documents/IdaraESRC/"
file_path <- paste(pc, "modelling2/variable_selection/names_index*.csv", sep = "")
bef <- paste(pc, "modelling2/variable_selection/names_", sep = "")
aft <- ".csv"
var_name_lists <- lapply(Sys.glob(file_path),
function(x) gsub(aft, "", gsub(bef, "", x)))
var_names <- lapply(Sys.glob(file_path),
function(x) fread(x, header = T))
var_names <- rbindlist(var_names)
library(data.table)
bef <- paste(pc, "modelling2/variable_selection/names_", sep = "")
aft <- ".csv"
var_name_lists <- lapply(Sys.glob(file_path),
function(x) gsub(aft, "", gsub(bef, "", x)))
var_names <- lapply(Sys.glob(file_path),
function(x) fread(x, header = T))
var_names <- rbindlist(var_names)
var_names <- var_names[, x]
var_names
file_path <- paste(pc, "modelling2/variable_selection/names_bio*.csv", sep = "")
bef <- paste(pc, "modelling2/variable_selection/names_", sep = "")
aft <- ".csv"
var_name_lists <- lapply(Sys.glob(file_path),
function(x) gsub(aft, "", gsub(bef, "", x)))
var_names <- lapply(Sys.glob(file_path),
function(x) fread(x, header = T))
var_names <- rbindlist(var_names)
var_names <- var_names[, x]
var_names
9/6
gg <- fread("modelling2/variable_selection/auc_prior_incids.csv")
library(ggplot2)
library(data.table)
library(reshape2)
gg <- fread("modelling2/variable_selection/auc_prior_incids.csv")
gg <- fread(paste(pc, "modelling2/variable_selection/auc_prior_incids.csv", sep = ""))
pc <- "/Users/emilyturner/Documents/IdaraESRC/"
gg <- fread(paste(pc, "modelling2/variable_selection/auc_prior_incids.csv", sep = ""))
gg
gg[grepl("n_w_idx")]
gg[grepl("n_w_idx", orig)]
diads2 <- copy(diads)
pc <- "/Users/emilyturner/Documents/IdaraESRC/"
library(data.table)
library(caret)
library(DMwR)
library(gbm)
# library(glmnet)
# library(infotheo)
library(purrr)
library(pROC)
library(plyr)
library(dplyr)
library(PRROC)
library(sets)
source(paste(pc, "functions/function_write_path.R", sep = ""))
source(paste(pc, "functions/function_ri_tr_te_ho.R", sep = ""))
tr_te_proportion <- 0.5
dat_c <- c("ipv", "non_ipv")
mod_c <- c("logreg_enet")
first_or_latest <- "random"
max_unanswered <- 26
dat_select <- paste(first_or_latest, max_unanswered, sep = "_")
24 * 5
80 /24
70/24
house_prices <- fread(paste(pc, "modelling2/lsoa_data/house_prices/v_hmlr_ppd_all_years_lsoa.csv", sep = ""))
house_prices[, table(year_transact)]
library(caret)
library(stringi)
library(geosphere)
library(lubridate)
source(paste(pc, "functions/function_ceil_floor_date.R", sep = ""))
house_prices
house_prices <- house_prices[, .(lsoa_code, year_transact, average_transact, number_transact)]
crimes_desc12 <- fread(paste(pc, "modelling2/lsoa_data/manc_crimes_desc_12mth.csv", sep = ""))
crimes_desc12
crimes_desc12[, year_end := as.Date(year_end)]
crimes_desc12
crimes_desc12 <- fread(paste(pc, "modelling2/lsoa_data/manc_crimes_desc_12mth.csv", sep = ""))
crimes_desc12[, year := year(as.Date(year_end))]
house_prices <- fread(paste(pc, "modelling2/lsoa_data/house_prices/v_hmlr_ppd_all_years_lsoa.csv", sep = ""))
house_prices <- house_prices[, .(lsoa_code, year_transact, average_transact, number_transact)]
house_prices[, table(year_transact)]
nrow(house_prices) == nrow(unique(house_prices, by = c("lsoa_code", "year_transact")))
crimes_desc12[, year_cor := year(as.Date(year_end))]
crimes_desc12
head(house_prices)
jj <- copy(crimes_desc12)
jj <- merge(jj, house_prices,
by.x = c("LSOA.code", "cor_year"),
by.y = c("lsoa_code", "year_transact"))
crimes_desc12[, year_cor := year(as.Date(year_end))]
crimes_desc12 <- merge(crimes_desc12, house_prices,
by.x = c("LSOA.code", "year_cor"),
by.y = c("lsoa_code", "year_transact"))
crimes_desc12 <- unique(crimes_desc12)
crimes_desc12[, LSOA.code := NULL]
crimes_desc12 <- round(cor(crimes_desc12), 3)
crimes_desc12[, year_cor := as.numeric(year(as.Date(year_end)))]
crimes_desc12 <- round(cor(crimes_desc12), 3)
crimes_desc12
tmp <- fread(paste(pc, "modelling2/lsoa_data/workday_pop.csv", sep = ""),
select = c("geography", "workday_pop", "area_hectares"))
tmp <- fread(paste(pc, "modelling2/lsoa_data/workday_pop.csv", sep = ""),
select = c("geography", "workday_pop"))
crimes_desc12 <- fread(paste(pc, "modelling2/lsoa_data/manc_crimes_desc_12mth.csv", sep = ""))
crimes_desc12[, year_end := as.Date(year_end)]
crimes_desc12[, year_cor := as.numeric(year(as.Date(year_end)))]
tmp <- fread(paste(pc, "modelling2/lsoa_data/workday_pop.csv", sep = ""),
select = c("geography", "workday_pop"))
nrow(tmp)
ons_post <- fread(paste(pc, "modelling2/lsoa_data/ons_postcodes.csv", sep = ""), select = c("pcd7", "lsoa11cd", "oa11cd", "ladnm"))
ons_post <- fread(paste(pc, "modelling2/lsoa_data/ons_postcodes.csv", sep = ""), select = c("lsoa11cd", "oa11cd"))
tmp_ons <- unique(copy(ons_post[, .(lsoa11cd, oa11cd)]))
nrow(tmp)
tmp <- merge(tmp, tmp_ons, by.x = "geography", by.y = "oa11cd")
nrow(tmp)
tmp <- tmp[, list(sum(as.numeric(workday_pop)), sum(as.numeric(area_hectares))), by = lsoa11cd]
tmp <- fread(paste(pc, "modelling2/lsoa_data/workday_pop.csv", sep = ""),
select = c("geography", "workday_pop", "area_hectares"))
ons_post <- fread(paste(pc, "modelling2/lsoa_data/ons_postcodes.csv", sep = ""), select = c("lsoa11cd", "oa11cd"))
tmp_ons <- unique(copy(ons_post[, .(lsoa11cd, oa11cd)]))
nrow(tmp)
tmp <- merge(tmp, tmp_ons, by.x = "geography", by.y = "oa11cd")
nrow(tmp)
tmp <- tmp[, sum(as.numeric(workday_pop)), by = lsoa11cd]
names(tmp)[2] <- c("workday_pop")
tmp
tmp <- fread(paste(pc, "modelling2/lsoa_data/workday_pop.csv", sep = ""),
select = c("geography", "workday_pop"))
ons_post <- fread(paste(pc, "modelling2/lsoa_data/ons_postcodes.csv", sep = ""), select = c("lsoa11cd", "oa11cd"))
tmp_ons <- unique(copy(ons_post[, .(lsoa11cd, oa11cd)]))
nrow(tmp)
tmp <- merge(tmp, tmp_ons, by.x = "geography", by.y = "oa11cd")
nrow(tmp)
tmp <- tmp[, sum(as.numeric(workday_pop)), by = lsoa11cd]
names(tmp)[2] <- c("workday_pop")
crimes_desc12 <- merge(crimes_desc12, tmp,
by.x = c("LSOA.code"),
by.y = c("lsoa11cd"))
crimes_desc12 <- unique(crimes_desc12)
crimes_desc12[, LSOA.code := NULL]
crimes_desc12
crimes_desc12 <- fread(paste(pc, "modelling2/lsoa_data/manc_crimes_desc_12mth.csv", sep = ""))
crimes_desc12[, year_end := as.Date(year_end)]
tmp <- fread(paste(pc, "modelling2/lsoa_data/workday_pop.csv", sep = ""),
select = c("geography", "workday_pop"))
ons_post <- fread(paste(pc, "modelling2/lsoa_data/ons_postcodes.csv", sep = ""), select = c("lsoa11cd", "oa11cd"))
tmp_ons <- unique(copy(ons_post[, .(lsoa11cd, oa11cd)]))
nrow(tmp)
tmp <- merge(tmp, tmp_ons, by.x = "geography", by.y = "oa11cd")
nrow(tmp)
tmp <- tmp[, sum(as.numeric(workday_pop)), by = lsoa11cd]
names(tmp)[2] <- c("workday_pop")
crimes_desc12 <- merge(crimes_desc12, tmp,
by.x = c("LSOA.code"),
by.y = c("lsoa11cd"))
crimes_desc12 <- unique(crimes_desc12)
crimes_desc12[, LSOA.code := NULL]
crimes_desc12[, chk_yr := year(year_end)]
crimes_desc12[, year_end := NULL]
crimes_desc12
crimes_desc12 <- round(cor(crimes_desc12), 3)
nn <- names(crimes_desc12)[3:length(names(crimes_desc))]
crimes_desc12
crimes_desc12 <- fread(paste(pc, "modelling2/lsoa_data/manc_crimes_desc_12mth.csv", sep = ""))
crimes_desc12[, year_end := as.Date(year_end)]
tmp <- fread(paste(pc, "modelling2/lsoa_data/workday_pop.csv", sep = ""),
select = c("geography", "workday_pop"))
ons_post <- fread(paste(pc, "modelling2/lsoa_data/ons_postcodes.csv", sep = ""), select = c("lsoa11cd", "oa11cd"))
tmp_ons <- unique(copy(ons_post[, .(lsoa11cd, oa11cd)]))
nrow(tmp)
tmp <- merge(tmp, tmp_ons, by.x = "geography", by.y = "oa11cd")
nrow(tmp)
tmp <- tmp[, sum(as.numeric(workday_pop)), by = lsoa11cd]
names(tmp)[2] <- c("workday_pop")
nn <- names(crimes_desc12)[3:length(names(crimes_desc12))]
crimes_desc12 <- merge(crimes_desc12, tmp,
by.x = c("LSOA.code"),
by.y = c("lsoa11cd"))
crimes_desc12 <- unique(crimes_desc12)
crimes_desc12[, LSOA.code := NULL]
crimes_desc12[, chk_yr := year(year_end)]
crimes_desc12[, year_end := NULL]
crimes_desc12[, (nn) := lapply(.SD, function(x) x/workday_pop), .SDcols = (nn)]
crimes_desc12
cor_mat <- round(cor(crimes_desc12), 3)
cor_mat <- melt(cor_mat)
ggplot(cor_mat, aes(Var1, Var2, fill = value)) +
geom_tile() +
theme(axis.text.x = element_text(angle=60, hjust=1))
cor_mat
crimes_desc12 <- fread(paste(pc, "modelling2/lsoa_data/manc_crimes_desc_12mth.csv", sep = ""))
crimes_desc12
head(cor_mat)
toppies <- copy(cor_mat[order(value)])
toppies <- copy(cor_mat[order(cor_mat$value)])
toppies <- copy(cor_mat[order(cor_mat$value), ])
bottoms <- copy(cor_mat[order(-cor_mat$value), ])
cor_mat <- as.data.table(melt(cor_mat))
cor_mat <- round(cor(crimes_desc12), 3)
cor_mat <- as.data.table(melt(cor_mat))
cor_mat <- round(cor(crimes_desc12), 3)
cor_mat <- melt(cor_mat)
crimes_desc12 <- fread(paste(pc, "modelling2/lsoa_data/manc_crimes_desc_12mth.csv", sep = ""))
crimes_desc12[, year_end := as.Date(year_end)]
tmp <- fread(paste(pc, "modelling2/lsoa_data/workday_pop.csv", sep = ""),
select = c("geography", "workday_pop"))
ons_post <- fread(paste(pc, "modelling2/lsoa_data/ons_postcodes.csv", sep = ""), select = c("lsoa11cd", "oa11cd"))
tmp_ons <- unique(copy(ons_post[, .(lsoa11cd, oa11cd)]))
nrow(tmp)
tmp <- merge(tmp, tmp_ons, by.x = "geography", by.y = "oa11cd")
nrow(tmp)
tmp <- tmp[, sum(as.numeric(workday_pop)), by = lsoa11cd]
names(tmp)[2] <- c("workday_pop")
nn <- names(crimes_desc12)[3:length(names(crimes_desc12))]
crimes_desc12 <- merge(crimes_desc12, tmp,
by.x = c("LSOA.code"),
by.y = c("lsoa11cd"))
crimes_desc12 <- unique(crimes_desc12)
crimes_desc12[, LSOA.code := NULL]
crimes_desc12[, chk_yr := year(year_end)]
crimes_desc12[, year_end := NULL]
crimes_desc12[, (nn) := lapply(.SD, function(x) x/workday_pop), .SDcols = (nn)]
cor_mat <- round(cor(crimes_desc12), 3)
cor_mat <- melt(cor_mat)
cor_mat <- as.data.table(cor_mat)
toppies <- copy(cor_mat[order(value)])
bottoms <- copy(cor_mat[order(-value)])
toppies
toppies <- copy(cor_mat[order(-value)])
toppies <- copy(cor_mat[value != 1, order(-value)])
bottoms <- copy(cor_mat[order(value)])
toppies
toppies <- copy(cor_mat[order(-value)])
bottoms <- copy(cor_mat[order(value)])
toppies <- toppies[value != 1]
toppies[1:10]
bottoms[1:10]
help(cor)
cor_mat[, both := list(Var1, Var2)]
var_nms <- cor_mat[, Var1]
var_nms <- unique(cor_mat[, Var1])
var_nms[, idx := 1:.N]
var_nms <- unique(cor_mat[, .(Var1)])
var_nms[, idx := 1:.N]
cor_mat <- merge(cor_mat, var_nms, by = "Var1")
cor_mat <- merge(cor_mat, var_nms, by.x = "Var2", by.y = "Var1")
cor_mat
crimes_desc12 <- fread(paste(pc, "modelling2/lsoa_data/manc_crimes_desc_12mth.csv", sep = ""))
crimes_desc12[, year_end := as.Date(year_end)]
tmp <- fread(paste(pc, "modelling2/lsoa_data/workday_pop.csv", sep = ""),
select = c("geography", "workday_pop"))
ons_post <- fread(paste(pc, "modelling2/lsoa_data/ons_postcodes.csv", sep = ""), select = c("lsoa11cd", "oa11cd"))
tmp_ons <- unique(copy(ons_post[, .(lsoa11cd, oa11cd)]))
nrow(tmp)
tmp <- merge(tmp, tmp_ons, by.x = "geography", by.y = "oa11cd")
nrow(tmp)
tmp <- tmp[, sum(as.numeric(workday_pop)), by = lsoa11cd]
names(tmp)[2] <- c("workday_pop")
nn <- names(crimes_desc12)[3:length(names(crimes_desc12))]
crimes_desc12 <- merge(crimes_desc12, tmp,
by.x = c("LSOA.code"),
by.y = c("lsoa11cd"))
crimes_desc12 <- unique(crimes_desc12)
crimes_desc12[, LSOA.code := NULL]
crimes_desc12[, chk_yr := year(year_end)]
crimes_desc12[, year_end := NULL]
crimes_desc12[, (nn) := lapply(.SD, function(x) x/workday_pop), .SDcols = (nn)]
cor_mat <- round(cor(crimes_desc12), 3)
cor_mat <- melt(cor_mat)
cor_mat <- as.data.table(cor_mat)
var_nms <- unique(cor_mat[, .(Var1)])
var_nms[, idx := 1:.N]
cor_mat <- merge(cor_mat, var_nms, by = "Var1")
cor_mat <- merge(cor_mat, var_nms, by.x = "Var2", by.y = "Var1")
cor_mat
cor_mat <- cor_mat[idx.x > idx.y]
toppies <- copy(cor_mat[order(-value)])
bottoms <- copy(cor_mat[order(value)])
toppies[1:10]
bottoms[1:10]
toppies[1:15]
toppies[1:15]
bottoms[1:10]
install.packages("earth")
install.packages("earth")
install.packages("earth")
install.packages("earth")
install.packages("earth")
library(earth)
library(data.table)
library(caret)
library(DMwR)
library(purrr)
library(pROC)
library(plyr)
library(dplyr)
library(PRROC)
library(sets)
library(mltools)
# hd <- "/media/veracrypt6/Medina_File_01/"
hd <- "/Time Machine Backups/IdaraESRC/"
# pc <- "/home/mbaxret2/Documents/IdaraESRC/"
pc <- "/Users/emilyturner/Documents/IdaraESRC/"
directory <- paste(hd, "models/base_data/", sep = "")
# directory <- "/Users/emilyturner/Documents/IdaraESRC dummy sets/"
source(paste(pc, "functions/function_write_path.R", sep = ""))
source(paste(pc, "functions/function_ri_tr_te_ho.R", sep = ""))
source(paste(pc, "functions/function_discrete.R", sep = ""))
# first_or_latest <- "firsts"
first_or_latest <- "random"
max_unanswered <- 26
dat_select <- paste(first_or_latest, max_unanswered, sep = "_")
folds <- 2
test_run <- "nope"
dat_c <- c("ipv", "non_ipv")
seed <- c(2030, 1999, 35, 65, 2)
results_directory <- "/Time Machine Backups/IdaraESRC/IdaraESRC_results_test_run/"
ocs <- c("new_crime_flag_365_subset_crimes_revic", "new_crime_flag_365_subset_crimes_recid")
mod_c <- c("rf")
dat_set <- "ipv"
oc_name <- ocs[1]
mod_name <- "rf"
folds_i <- 1
ss <- 35
res_auc_tr_te <- fread(write_path("auc_tr_te"))
library(data.table)
install.packages(c("caret", "data.table"))
res_auc_tr_te <- fread(write_path("auc_tr_te"))
library(caret)
library(data.table)
res_auc_tr_te <- fread(write_path("auc_tr_te"))
results_directory <- "/media/Time Machine Backups/IdaraESRC/IdaraESRC_results_test_run/"
res_auc_tr_te <- fread(write_path("auc_tr_te"))
results_directory <- "/Volumes/Time Machine Backups/IdaraESRC/IdaraESRC_results_test_run/"
res_auc_tr_te <- fread(write_path("auc_tr_te"))
res_auc_ho <- fread(write_path("auc_ho"))
all_aucs <- NULL
for (dat_set in dat_c) {
for (oc_name in ocs){
for (mod_name in mod_c) {
for (folds_i in 1:2) {
for (ss in seed) {
res_auc_tr_te <- fread(write_path("auc_tr_te"))
res_auc_ho <- fread(write_path("auc_ho"))
res_auc <- data.table(base_select = dat_select, data = dat_set,
model = mod_name,
oc_name = oc_name,
fold_id = ff, res_auc_tr_te, res_auc_ho)
all_aucs <- rbindlist(list(all_aucs, res_auc))
}
}
}
#
}
}
all_aucs <- NULL
for (dat_set in dat_c) {
for (oc_name in ocs){
for (mod_name in mod_c) {
ff <- 0
for (folds_i in 1:2) {
for (ss in seed) {
ff <- ff + 1
res_auc_tr_te <- fread(write_path("auc_tr_te"))
res_auc_ho <- fread(write_path("auc_ho"))
res_auc <- data.table(base_select = dat_select, data = dat_set,
model = mod_name,
oc_name = oc_name,
fold_id = ff, res_auc_tr_te, res_auc_ho)
all_aucs <- rbindlist(list(all_aucs, res_auc))
}
}
}
#
}
}
all_aucs
mod_c <- c("rf")
all_aucs <- NULL
for (dd in c("pap2", "test_run")) {
results_directory <- paste("/Volumes/Time Machine Backups/IdaraESRC/IdaraESRC_results_", dd, "/", sep = "")
for (dat_set in dat_c) {
for (oc_name in ocs){
for (mod_name in mod_c) {
ff <- 0
for (folds_i in 1:2) {
for (ss in seed) {
ff <- ff + 1
res_auc_tr_te <- fread(write_path("auc_tr_te"))
res_auc_ho <- fread(write_path("auc_ho"))
res_auc <- data.table(res_folder = dd, base_select = dat_select, data = dat_set,
model = mod_name,
oc_name = oc_name,
fold_id = ff, res_auc_tr_te, res_auc_ho)
all_aucs <- rbindlist(list(all_aucs, res_auc))
}
}
}
#
}
}
}
head(all_aucs)
mean_aucs <- all_aucs[, list(mean(auc_ho), sd(ho)), by = .(res_folder, data, oc_name)]
mean_aucs <- all_aucs[, list(mean(auc_ho), sd(auc_ho),
mean(auc_tr_te), sd(auc_tr_te)),
by = .(res_folder, data, oc_name)]
mean_aucs
install.packages(c("pROC", "PRROC"))
library(dplyr)
library(plyr)
library(reshape2)
library(kableExtra)
install.packages("kableExtra")
6/.28
6/.17
2.5/.17
2.2/1.7
1.92/1.03
80/(2*pi)
2 * pi * 20
sin(90)
sin(sin())
help(sin)
112 * sin(65) / sin(70)
sin(65)
sin(70)
sin(21) * 9 / sin(46)
sinpi(21) * 9 / sinpi(46)
rad2 <- pi/180
sin(21*rad2) * 9 / sin(46*rad2)
112 * sin(65 * rad2) / sin(70 * rad2)
num5 = 34 / 5
multiple5 = 34 / 5
multiple3 = 34 / 3
multipleBoth = 34 / 15
3 * [1:11]
3 * 1:11
sum(3 * 1:11) + sum(5 * 1:6) - 45
1:34 %% 3 == 0
vec3 = 1:34 %% 3 == 0
vec5 <- 1:34 %% 5 == 0
vecBoth <- 1:34 %% 15 == 0
vec1To34 <- 1:34
vv <- vec1To34
sum(vv * vec3) + sum(vv * vec5) - sum(vv * vecBoth)
vv
1.25 * 3
c(1:10)
c(1:10)*9
getwd()
setwd("/Users/emilyturner/Home/Documents")
setwd("/Users/emilyturner/Documents")
setwd("/Users/emilyturner/Documents/NorthCoders/review/be-nc-news")
jj <- read.csv(endpoints)
jj <- read.csv('endpoints.csv')
jj
